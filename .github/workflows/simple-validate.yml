name: Simple Validation Test

on:
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  basic-validation:
    name: Basic Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python & Ansible
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install minimal dependencies
      run: |
        pip install ansible-core
        
    - name: Test basic ansible installation
      run: |
        ansible --version
        
    - name: Test inventory parsing
      run: |
        ansible-inventory --list -i .github/ci_inventory.ini
        
    - name: Test site.yml syntax without vault
      run: |
        # Create minimal test vars
        mkdir -p /tmp/test_vars
        echo "---" > /tmp/test_vars/test.yml
        echo "vip: 192.168.1.99" >> /tmp/test_vars/test.yml
        echo "kubernetes_version: 1.32.0" >> /tmp/test_vars/test.yml
        echo "pod_network_cidr: 10.244.0.0/16" >> /tmp/test_vars/test.yml
        
        # Try syntax check with minimal vars
        ansible-playbook site.yml --syntax-check -i .github/ci_inventory.ini -e "@/tmp/test_vars/test.yml" || echo "Syntax check failed - this needs debugging"
        
    - name: Show file structure for debugging
      run: |
        echo "Repository structure:"
        find . -type f -name "*.yml" | head -20