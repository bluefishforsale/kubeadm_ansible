name: Ultra Simple Test

on:
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  ultra-basic:
    name: Ultra Basic Test
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install ansible
      run: |
        pip install ansible-core
        
    - name: Test ansible basic functionality
      run: |
        ansible --version
        
    - name: Test simplest possible inventory
      run: |
        echo "[all]" > /tmp/test.ini
        echo "localhost ansible_connection=local" >> /tmp/test.ini
        echo "Testing simple inventory..."
        ansible-inventory --list -i /tmp/test.ini
        
    - name: Test inline inventory 
      run: |
        ansible all -i "localhost," -m setup --connection=local | head -10 || echo "Inline inventory test failed"
        
    - name: Show current directory contents
      run: |
        pwd
        ls -la
        
    - name: Test our minimal inventory step by step
      run: |
        echo "Creating minimal inventory..."
        cat > /tmp/minimal.ini << 'EOF'
        [all:vars]
        ansible_connection=local
        
        [testgroup]
        testhost
        EOF
        
        echo "Content:"
        cat /tmp/minimal.ini
        
        echo "Parsing..."
        ansible-inventory --list -i /tmp/minimal.ini || echo "Minimal inventory failed"